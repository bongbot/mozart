- entity_name = controller.controller_name.singularize.underscore
- @entity = instance_variable_get("@#{entity_name}")
- create_id = "edit_#{entity_name}"
- index_path = index_path(entity_name)

- if @entity.valid?
  = redirect_to_previous_path_if_needed_or_redirect_to(index_path)

- else
  $('##{create_id}').html('#{ j render(:partial => "new") }');
  $('##{create_id}').effect("shake", { duration:250, distance: 6 });
  $('#new_#{entity_name} input[type!=hidden]').first().focus();
